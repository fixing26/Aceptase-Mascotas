<!DOCTYPE html>
<html lang="es">

	<head>
		<meta charset="UTF-8">
		<title>Aceptase Mascotas! - Mis Anuncios</title>
		<link rel="stylesheet" href="/css/global.css">
		<link rel="stylesheet" href="/css/menu.css">
		<link rel="stylesheet" href="/css/misanuncios.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
		<link rel="shortcut icon" type="image" href="img/icon-pet-paw.svg">
		
	</head>
	<body>
		<div class="container">
			<div class="back">
				<header class="header">
					<a href="index.html" class="title">Aceptase Mascotas</a>
					<nav>
						<ul class="navs">
							<li class="options border_options"><a href="nuevoanuncio.html">Anucie aqui</a></li>
							<li class="options border_options"><a href="">Mis anuncios</a></li>
							<li class="options border_options"><a href="">Favoritos</a></li>
							<li id="logout-btn" style="display: none;" class="options border_options"><a href="#" onclick="logout()">Cerrar sesión</a></li>
						</ul>
					</nav>
				</header>
				<div class="total">
					<div>
						<div class="container_info">
							<div class="icon_edit">
								<a href="nuevoanuncio.html"><span class="material-symbols-outlined input_svg position_bathroom btn_edit2">
									edit
								</span></a>
							</div>
							<div class="icon_delete">
								<span class="material-symbols-outlined input_svg position_bathroom btn_disable2">
									delete
								</span>
							</div>
							<div class="Resultado">
								<% if (Resultado.length > 0) { %>
								  <h2><%= Resultado[0].Ciudad %></h2>
								<% } %>
								<% Resultado.forEach(function(anuncio) { %>
								  <div class="info">
									<section class="container_slidephotos">
									  <ul class="photos">
										<% anuncio.files.forEach(function(file) { %>
										  <li class="photo" photo-active><img src="/uploads/<%= file.filename %>" alt="<%= file.originalname %>"></li>
										<% }); %>
									  </ul>
									  <button class="previous_btn" photo-change-slide-button="previous">&lt;</button>
									  <button class="next_btn" photo-change-slide-button="next">&gt;</button>
									</section>
									<div class="description">
									  <h3 class="price"><%= anuncio.Precio %>€/mes</h3>
									  <h3 class="size"><span class="material-symbols-outlined input_svg">resize</span><%= anuncio.Area %>m²</h3>
									  <p class="zona"><%= anuncio.Descripcion %></p>
									  <span class="material-symbols-outlined input_svg position_bed">bed</span>
									  <p class="beds"><%= anuncio.NumeroHab %> habitaciones</p>
									  <span class="material-symbols-outlined input_svg position_bathroom">shower</span>
									  <p class="bathrooms"><%= anuncio.NumeroBan %> baños</p>
									  <span class="fav" id="favo">
										<span id="fav" class="positionbtnfav material-symbols-outlined input_svg dislike">heart_plus</span>
									  </span>
									</div>
								  </div>
								<% }); %>
							  </div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		</div><footer class="container_footer"><p>© copyright 2024 - Aceptase Mascotas!</p></footer>
		<script>
			const allChangePhotoButtons = document.querySelectorAll("[photo-change-slide-button]");

			allChangePhotoButtons.forEach(button => {
				button.addEventListener("click", () => {
					const photos = button.closest(".info").querySelector(".photos");
					const activePhoto = photos.querySelector("[photo-active]");
					const indexActivePhoto = Array.from(photos.children).indexOf(activePhoto);
					let indexNewActivePhoto;

					if (button.getAttribute("photo-change-slide-button") === "next") {
						indexNewActivePhoto = indexActivePhoto + 1;
					} else {
						indexNewActivePhoto = indexActivePhoto - 1;
					}
					if (indexNewActivePhoto >= photos.children.length) {
						indexNewActivePhoto = 0;
					}
					if (indexNewActivePhoto < 0) {
						indexNewActivePhoto = photos.children.length - 1;
					}
					activePhoto.removeAttribute("photo-active");
					photos.children[indexNewActivePhoto].setAttribute("photo-active", "true");
				});
			});

			document.addEventListener('DOMContentLoaded', function() {
			const token = localStorage.getItem('token');
			console.log('Token',token);
			if (token) {
				// Si hay un token en el almacenamiento local, el usuario está logeado
				document.getElementById('logout-btn').style.display = 'inline-block'; // Mostrar el botón de cerrar sesión
				document.getElementById('login-btn').style.display = 'none'; // Ocultar el botón de inicio de sesión
				document.getElementById('Anuncie').style.display = 'inline-block';
				document.getElementById('Mis anuncios').style.display = 'inline-block';
				document.getElementById('Favoritos').style.display = 'inline-block';
			} else {
				// Si no hay token en el almacenamiento local, el usuario no está logeado
				document.getElementById('logout-btn').style.display = 'none'; // Ocultar el botón de cerrar sesión
				document.getElementById('login-btn').style.display = 'inline-block'; // Mostrar el botón de inicio de sesión
				document.getElementById('Anuncie').style.display = 'none';
				document.getElementById('Mis anuncios').style.display = 'none';
				document.getElementById('Favoritos').style.display = 'none';
			}
		});
		function logout() {
			// Eliminar la información del usuario del almacenamiento local
			localStorage.removeItem('token');
			// Redirigir al usuario a la página de inicio de sesión
			window.location.href = 'login.html';
		}

		</script>
	</body>

</html>