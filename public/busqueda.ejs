<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Aceptase Mascotas! - Busqueda</title>
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/menu.css">
  <link rel="stylesheet" href="/css/paginaBusqueda.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="shortcut icon" type="image" href="/img/icon-pet-paw.svg">
</head>
<body>
  <div class="container">
    <div class="back">
      <header class="header">
        <a href="index.html" class="title">Aceptase Mascotas</a>
        <nav>
          <ul class="navs">
            <li id="Anuncie" class="options border_options"><a href="nuevoanuncio.html">Anuncie aqui</a></li>
            <li id="Mis anuncios" class="options border_options"><a href="misanuncios.html">Mis anuncios</a></li>
            <li id="Favoritos" class="options border_options"><a href="">Favoritos</a></li>
            <li id="logout-btn" class="options border_options"><a href="#" onclick="logout()">Cerrar sesión</a></li>
            <li id="login-btn" class="options login" style="display: inline-block;"><a href="login.html">ENTRAR</a></li>
          </ul>
        </nav>
      </header>
      <div class="total">
        <div class="filter_container">
          <form action="/Anuncio/filtrar" method="get"  id="filterForm">
            <div class="search_container search_city">
							<input class="search_input" type="text" name="ciudad" id="ciudad" placeholder="Ciudad, Provincia... ">
							<div class="autocomplete"></div>
						</div>
            <div>
                <label for="minPrecio">Precio Mínimo:</label>
                <input type="number" id="minPrecio" name="minPrecio">
            </div>
            <div>
                <label for="maxPrecio">Precio Máximo:</label>
                <input type="number" id="maxPrecio" name="maxPrecio">
            </div>
            <div>
                <label for="tipo">Tipo de Vivienda:</label>
                <select id="tipo" name="tipo">
                    <option value="">Cualquiera</option>
                    <option value="casa">Casa</option>
                    <option value="apartamento">Apartamento</option>
                </select>
            </div>
            <div>
                <label for="numHabitaciones">Número de Habitaciones:</label>
                <select id="numHabitaciones" name="numHabitaciones">
                    <option value="">Cualquiera</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3+</option>
                </select>
            </div>
            <div>
                <label for="numBanos">Número de Baños:</label>
                <select id="numBanos" name="numBanos">
                    <option value="">Cualquiera</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3+</option>
                </select>
            </div>
            <div>
                <label for="minArea">Área Mínima:</label>
                <input type="number" id="minArea" name="minArea">
            </div>
            <div>
                <label for="maxArea">Área Máxima:</label>
                <input type="number" id="maxArea" name="maxArea">
            </div>
            <div>
                <button type="submit">Filtrar</button>
            </div>
        </form>
        </div>
        <div class="Resultado">
          <% Resultado.forEach(function(anuncio) { %>
            <div class="info">
              <section class="container_slidephotos">
                <ul class="photos">
                  <% anuncio.files.forEach(function(file) { %>
                    <li class="photo" photo-active><img src="/uploads/<%= file.filename %>" alt="<%= file.originalname %>"></li>
                  <% }); %>
                </ul>
                <button class="previous_btn" photo-change-slide-button="previous">&lt;</button>
                <button class="next_btn" photo-change-slide-button="next">&gt;</button>
              </section>
              <div class="description">
                <h3 class="AnuncioCiudad"><%= anuncio.Ciudad %></h3>
                <h3 class="price"><%= anuncio.Precio %>€/mes</h3>
                <h3 class="size"><span class="material-symbols-outlined input_svg">resize</span><%= anuncio.Area %>m²</h3>
                <p class="zona"><%= anuncio.Descripcion %></p>
                <span class="material-symbols-outlined input_svg position_bed">bed</span>
                <p class="beds"><%= anuncio.NumeroHab %> habitaciones</p>
                <span class="material-symbols-outlined input_svg position_bathroom">shower</span>
                <p class="bathrooms"><%= anuncio.NumeroBan %> baños</p>
                <span class="fav" id="favo">
                  <span id="fav" class="positionbtnfav material-symbols-outlined input_svg dislike">heart_plus</span>
                </span>
              </div>
            </div>
          <% }); %>
        </div>
      </div>
    </div>
  </div>
  <footer class="container_footer">
    <p>© copyright 2024 - Aceptase Mascotas!</p>
  </footer>

	<script>
		// función para cambiar las fotos.
		const changePhotoButtons = document.querySelectorAll("[photo-change-slide-button]");
		changePhotoButtons.forEach(button => {
			button.addEventListener("click", () => {
				/*console.log("entra")*/
				const photos = document.querySelector(".photos");
				const activePhoto = photos.querySelector("[photo-active]");
				const indexActivePhoto = Array.from(photos.children).indexOf(activePhoto);
				let indexNewActivePhoto;

				if (button.dataset.changeSlideButton === "next") {
					indexNewActivePhoto = indexActivePhoto + 1;
				} else {
					indexNewActivePhoto = indexActivePhoto - 1;
				}
				if (indexNewActivePhoto >= photos.children.length) {
					indexNewActivePhoto = 0;
				}
				if (indexNewActivePhoto < 0) {
					indexNewActivePhoto = photos.children.length - 1;
				}
				activePhoto.removeAttribute("photo-active");
				photos.children[indexNewActivePhoto].setAttribute("photo-active", true);
			});
		});
	
		document.addEventListener('DOMContentLoaded', function() {
			const token = localStorage.getItem('token');
			console.log('Token',token);
			if (token) {
				// Si hay un token en el almacenamiento local, el usuario está logeado
				document.getElementById('logout-btn').style.display = 'inline-block'; // Mostrar el botón de cerrar sesión
				document.getElementById('login-btn').style.display = 'none'; // Ocultar el botón de inicio de sesión
				document.getElementById('Anuncie').style.display = 'inline-block';
				document.getElementById('Mis anuncios').style.display = 'inline-block';
				document.getElementById('Favoritos').style.display = 'inline-block';
				
			} else {
				// Si no hay token en el almacenamiento local, el usuario no está logeado
				document.getElementById('logout-btn').style.display = 'none'; // Ocultar el botón de cerrar sesión
				document.getElementById('login-btn').style.display = 'inline-block'; // Mostrar el botón de inicio de sesión
				document.getElementById('Anuncie').style.display = 'none';
				document.getElementById('Mis anuncios').style.display = 'none';
				document.getElementById('Favoritos').style.display = 'none';
				
			}
		});
	
		function logout() {
			// Eliminar la información del usuario del almacenamiento local
			localStorage.removeItem('token');
			// Redirigir al usuario a la página de inicio de sesión
			window.location.href = 'login.html';
		}
	

    let cities = [
		"Sevilla, Andalucía",
		"Zaragoza, Aragón",
		"Oviedo, Asturias",
		"Santander, Cantabria",
		"Toledo, Castilla-La Mancha",
		"Castilla y León",
		"Barcelona, Cataluña",
		"Mérida, Extremadura",
		"Santiago de Compostela, Galicia",
		"Palma, Islas Baleares",
		"Islas Canarias",
		"Logroño, La Rioja",
		"Madrid, Madrid",
		"Murcia, Murcia",
		"Pamplona, Navarra",
		"Vitoria-Gasteiz, País Vasco",
		"Valencia, Valencia",    
		];

		const searchContent = document.querySelector(".search_city");
		const inputBox = document.querySelector(".search_input");
		const sugestionBox = document.querySelector(".autocomplete");
		const autocompleteBusqueda = cities;

		inputBox.onkeyup = (e) => {
		let userData = e.target.value;
		let emptyArray = [];
		if (userData) {
			emptyArray = autocompleteBusqueda.filter((data) => {
			return data.toLocaleLowerCase().startsWith(userData.toLocaleLowerCase());
			});

			emptyArray = emptyArray.map((data) => {
			return `<li>${data}</li>`;
			});
			searchContent.classList.add("active");
			showCities(emptyArray);
			let allList = sugestionBox.querySelectorAll("li");

			for (let index = 0; index < allList.length; index++) {
			allList[index].addEventListener("click", () => select(allList[index]));
			}
		} else {
			searchContent.classList.remove("active");
			sugestionBox.innerHTML = "";
		}
		};

		function select(element) {
		let selectData = element.textContent;
		inputBox.value = selectData;
		searchContent.classList.remove("active");
		sugestionBox.innerHTML = "";
		}

		function showCities(list) {
		let listData;
		if (!list.length) {
			let userValue = inputBox.value;
			listData = `<li>${userValue}</li>`;
			searchContent.classList.remove("active");
		} else {
			listData = list.join("");
			searchContent.classList.add("active");
		}
		sugestionBox.innerHTML = listData;
		}

	</script>
  </body>

</html>