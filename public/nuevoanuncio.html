<!DOCTYPE html>
<html lang="es">

	<head>
		<meta charset="UTF-8">
		<title>Aceptase Mascotas! - Anuncie aqui</title>
		<link rel="stylesheet" href="css/global.css">
		<link rel="stylesheet" href="css/menu.css">
		<link rel="stylesheet" href="css/nuevoanuncio.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
		<link rel="shortcut icon" type="image" href="img/icon-pet-paw.svg">
		
	</head>
  <body>
	<div class="container">
		<div class="back">
			<header class="header">
				<a href="index.html" class="title">Aceptase Mascotas</a>
				<nav>
					<ul class="navs">
						<li class="options border_options"><a href="">Anucie aqui</a></li>
						<li class="options border_options"><a href="misanuncios.html">Mis anuncios</a></li>
						<li class="options border_options"><a href="">Favoritos</a></li>
						<li id="logout-btn" style="display: none;" class="options border_options"><a href="#" onclick="logout()">Cerrar sesión</a></li>
					</ul>
				</nav>
			</header>
			<div class="total">
				<div class="form_container">
					<form action="/Anuncio/nuevoanuncio" method="post" id="AnuncioForm">
						<h2 class="title1">Nuevo anuncio</h2>
						<h3  class="title2">Ciudad, Provincia</h3>
						<div class="custom-select"></div>
						<select name="cities" id="Ciudad" class="inputCities input">
							<option value="Barcelona, Cataluña">Barcelona, Cataluña</option>
							<option value="Castilla y León">Castilla y León</option>
							<option value="Islas Canarias">Islas Canarias</option>
							<option value="Logroño, La Rioja">Logroño, La Rioja</option>
							<option value="Madrid, Madrid">Madrid, Madrid</option>
							<option value="Mérida, Extremadura">Mérida, Extremadura</option>
							<option value="Murcia, Murcia">Murcia, Murcia</option>
							<option value="Oviedo, Asturias">Oviedo, Asturias</option>
							<option value="Palma, Islas Baleares">Palma, Islas Baleares</option>
							<option value="Pamplona, Navarra">Pamplona, Navarra</option>
							<option value="Santander, Cantabria">Santander, Cantabria</option>
							<option value="Santiago de Compostela, Galicia">Santiago de Compostela, Galicia</option>
							<option value="Sevilla, Andalucía">Sevilla, Andalucía</option>
							<option value="Toledo, Castilla-La Mancha">Toledo, Castilla-La Mancha</option>
							<option value="Valencia, Valencia">Valencia, Valencia</option>
							<option value="Vitoria-Gasteiz, País Vasco">Vitoria-Gasteiz, País Vasco</option>
							<option value="Zaragoza, Aragón">Zaragoza, Aragón</option>							
						  </select>		
						<h3 class="title2">Tipo de vivienda</h3>
						<div class="options_radio">
							<input class="radio" type="radio" id="apartamento" name="inmueble" value="apartamento" required>
							<label for="apartamento">Apartamento</label>
							<input class="radio" type="radio" id="piso" name="inmueble" value="piso">
							<label for="piso">Piso</label>
							<input class="radio" type="radio" id="casa" name="inmueble" value="casa">
							<label for="casa">Casa</label>
							<input class="radio" type="radio" id="chalet" name="inmueble" value="chalet">
							<label for="chalet">Chalet</label>
						</div>
						<h3  class="title2">Numero de habitaciones</h3>
						<div class="options_radio">
							<input class="radio" type="radio" id="uno" name="habitaciones" value=1 required>
							<label for="uno">1</label><br>
							<input class="radio" type="radio" id="dos" name="habitaciones" value=2>
							<label for="dos">2</label><br>
							<input class="radio" type="radio" id="tres" name="habitaciones" value=3>
							<label for="tres">3+</label><br>
						</div>
						<h3  class="title2">Numero de baños</h3>
						<div class="options_radio">
							<input class="radio" type="radio" id="uno" name="banyos" value=1 required>
							<label for="uno">1</label><br>
							<input class="radio" type="radio" id="dos" name="banyos" value=2>
							<label for="dos">2</label><br>
							<input class="radio" type="radio" id="tres" name="banyos" value=3>
							<label for="tres">3+</label><br>
						</div>
						<h3  class="title2">Area del inmueble en m²</h3>
						<input class="input inputSize" type="number" min="0" placeholder="m²" id="Area" required><br>
						<h3 class="title2">Descripción del inmueble/zona</h3>
						<textarea class="input" class="description" maxlength="150" id="Descripcion" placeholder="Una breve descripción de la zona y del inmueble." required></textarea><br>
						<h3  class="title2">Precio del inmueble en €</h3>
						<input class="input inputSize" type="number" min="0" id="Precio" placeholder="€" required><br>
						<h3  class="title2">Fotos del anuncio</h3>
						<input type="file" id="upload" name="photos" accept="image/png, image/jpeg" />
						<label class="photos_file" for="upload">Seleccionar archivo</label>
						<br>
						<input class="btn" type="submit" value="Publicar el anuncio">
					</form>
				</div>
			</div>
		</div>
	</div>
	  <footer class="container_footer">
	<p>© copyright 2024 - Aceptase Mascotas!</p>
</footer>

	<script src=></script>
	<script>	
		document.getElementById('AnuncioForm').addEventListener('submit', async function(event) {
			event.preventDefault(); // Evitar que el formulario se envíe de forma tradicional
			
			const userId = localStorage.getItem('IdCreador');
			console.log('IdCreador', userId);
			
			const Ciudad = document.getElementById('Ciudad').value;
			const Tipo = document.querySelector('input[name="inmueble"]:checked').value;
			const NumeroHabs = document.querySelector('input[name="habitaciones"]:checked').value;
			const NumeroBan = document.querySelector('input[name="banyos"]:checked').value;
			const Area = document.getElementById('Area').value;
			const Descripcion = document.getElementById('Descripcion').value;
			const Precio = document.getElementById('Precio').value;
			const IdCreador = userId;
			// Enviar formulario al servidor
			try {
				const response = await fetch('/Anuncio/nuevoanuncio', {
					method: 'POST',
					body: JSON.stringify({ Ciudad: Ciudad, Tipo: Tipo, NumeroHabs: NumeroHabs, NumeroBan: NumeroBan, Area: Area, Descripcion: Descripcion, Precio: Precio, IdCreador: IdCreador }),
					headers: {
						'Content-Type': 'application/json'
					}
					
				});
				window.location.href = 'index.html';
	
			} catch (error) {
				console.error('Error al enviar el formulario de registro:', error);
				alert('Error al enviar el formulario de registro');
			}
			
		});

		document.addEventListener('DOMContentLoaded', function() {
			const token = localStorage.getItem('token');
			console.log('Token',token);
			if (token) {
				// Si hay un token en el almacenamiento local, el usuario está logeado
				document.getElementById('logout-btn').style.display = 'inline-block'; // Mostrar el botón de cerrar sesión
				document.getElementById('login-btn').style.display = 'none'; // Ocultar el botón de inicio de sesión
				document.getElementById('Anuncie').style.display = 'inline-block';
				document.getElementById('Mis anuncios').style.display = 'inline-block';
				document.getElementById('Favoritos').style.display = 'inline-block';
			} else {
				// Si no hay token en el almacenamiento local, el usuario no está logeado
				document.getElementById('logout-btn').style.display = 'none'; // Ocultar el botón de cerrar sesión
				document.getElementById('login-btn').style.display = 'inline-block'; // Mostrar el botón de inicio de sesión
				document.getElementById('Anuncie').style.display = 'none';
				document.getElementById('Mis anuncios').style.display = 'none';
				document.getElementById('Favoritos').style.display = 'none';
			}
		});
		function logout() {
			// Eliminar la información del usuario del almacenamiento local
			localStorage.removeItem('token');
			// Redirigir al usuario a la página de inicio de sesión
			window.location.href = 'login.html';
		}
	</script>
  </body>

</html>